<!DOCTYPE html>
<html lang="en-us"><head><meta charset="utf-8">
<meta http-equiv="content-type" content="text/html">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title itemprop="name"> | My New Hugo Site</title>
<meta property="og:title" content=" | My New Hugo Site" />
<meta name="twitter:title" content=" | My New Hugo Site" />
<meta itemprop="name" content=" | My New Hugo Site" />
<meta name="application-name" content=" | My New Hugo Site" />
<meta property="og:site_name" content="" />

<meta name="description" content="">
<meta itemprop="description" content="" />
<meta property="og:description" content="" />
<meta name="twitter:description" content="" />

<meta property="og:locale" content="en-us" />
<meta name="language" content="en-us" />

  <link rel="alternate" hreflang="en" href="https://example.org/tools/containers/skaffold/" title="" />






<meta name="generator" content="Hugo 0.134.3">

    
    <meta property="og:url" content="https://example.org/tools/containers/skaffold/">
  <meta property="og:site_name" content="My New Hugo Site">
  <meta property="og:title" content="My New Hugo Site">
  <meta property="og:description" content="Last week, we took a look at the key differences between Docker Swarm and Kubernetes. You’ve built your infrastructure and deployed the first version of your program. How do you make sure that new code and container images are defect free? And do this automatically to reduce the complexity of your system? Here are two tools to build, test, and deploy code.
Once a software engineer has introduced a new bug fix or feature update in a version control system such as Git. You want to run your code through a series of step:">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="tools">


    
    
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="My New Hugo Site">
  <meta name="twitter:description" content="Last week, we took a look at the key differences between Docker Swarm and Kubernetes. You’ve built your infrastructure and deployed the first version of your program. How do you make sure that new code and container images are defect free? And do this automatically to reduce the complexity of your system? Here are two tools to build, test, and deploy code.
Once a software engineer has introduced a new bug fix or feature update in a version control system such as Git. You want to run your code through a series of step:">


    

    <link rel="canonical" href="https://example.org/tools/containers/skaffold/">
    <link href="/style.min.e390ba7da26222f4dc42a349955d76dbbe44e5ce2535a43de5a70633a0a9ec3c.css" rel="stylesheet">
    <link href="/code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css" rel="stylesheet">

    
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg">
    <link rel="shortcut icon" href="/favicon.ico">




<link rel="manifest" href="https://example.org/site.webmanifest">

<meta name="msapplication-config" content="/browserconfig.xml">
<meta name="msapplication-TileColor" content="#2d89ef">
<meta name="theme-color" content="#434648">

    
    <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg">

    
    </head>
<body data-theme = "" class="notransition">

<script src="/js/theme.min.8961c317c5b88b953fe27525839672c9343f1058ab044696ca225656c8ba2ab0.js" integrity="sha256-iWHDF8W4i5U/4nUlg5ZyyTQ/EFirBEaWyiJWVsi6KrA="></script>

<div class="navbar" role="navigation">
    <nav class="menu" aria-label="Main Navigation">
        <a href="https://example.org/" class="logo">
            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" 
viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" 
stroke-linejoin="round" class="feather feather-home">
<title></title>
<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
<polyline points="9 22 9 12 15 12 15 22"></polyline>
</svg>
        </a>
        <input type="checkbox" id="menu-trigger" class="menu-trigger" />
        <label for="menu-trigger">
            <span class="menu-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" stroke="currentColor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7L3.40726 7"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488L3.49301 3.51488"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"></path><path stroke-linecap="round" stroke-linejoin="round" d="M0.5 12.5V1.5C0.5 0.947715 0.947715 0.5 1.5 0.5H12.5C13.0523 0.5 13.5 0.947715 13.5 1.5V12.5C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C0.947715 13.5 0.5 13.0523 0.5 12.5Z"></path></svg>
            </span>
        </label>

        <div class="trigger">
            <ul class="trigger-container">
                
                
                <li class="menu-separator">
                    <span>|</span>
                </li>
                
                
            </ul>
            <a id="mode" href="#">
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
            </a>
        </div>
    </nav>
</div>

<div class="wrapper post">
    <main class="page-content" aria-label="Content">
        <article>
            <header class="header">
                <h1 class="header-title"></h1>
                
            </header>
            
            <div class="page-content">
                <p>Last week, we took a look at the <a href="https://www.travis-ci.com/blog/products/docker-swarm-vs-kubernetes/">key differences between Docker Swarm and Kubernetes</a>. You&rsquo;ve built your infrastructure and deployed the first version of your program. How do you make sure that new code and  container images are defect free? And do this automatically to reduce the complexity of your system? Here are two tools to build, test, and deploy code.</p>
<p>Once a software engineer has introduced a new bug fix or feature update in a version control system such as Git. You want to run your code through a series of step:</p>
<ol>
<li>Detect changes in the code repository and build a new container image.</li>
<li>Test the new image for vulnerabilities, run units tests, and test the functionality.</li>
<li>Build and artifact for the CD stage. Where it is deployed.</li>
</ol>
<h2 id="using-skaffold-to-automate-continuous-integration">Using Skaffold to automate Continuous Integration.</h2>
<p>Skaffold is a CD tool that watches for code changes in a repository. Then it builds, tests, and deploys an application in Kubernetes. Skaffold watches source code for changes. When it detects a change, it will first build a container image that container the new changes. Once that is done, it will test the image for changes.</p>
<p>The testing is broken down into three parts:</p>
<ol>
<li>Unit Tests</li>
<li>Integration Tests</li>
<li>Security Scans</li>
</ol>
<p>Too see how this works. Let&rsquo;s take a look at a skaffold.yaml file. Which is the core configuration file for Skaffold.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Config</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">build</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">artifacts</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">image</span>: <span style="color:#ae81ff">project/code</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">local</span>: {}
</span></span><span style="display:flex;"><span><span style="color:#f92672">test</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">image</span>: <span style="color:#ae81ff">project/code</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">custom</span>:
</span></span><span style="display:flex;"><span>     - <span style="color:#f92672">command</span>: <span style="color:#e6db74">&#34;sftp -oBatchMode=no -oStrictHostKeyChecking=no user@localhost&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">structureTests</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./container-structure-tool/structure-tool.yaml</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">deploy</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">kubectl</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">manifests</span>:
</span></span><span style="display:flex;"><span>   - <span style="color:#ae81ff">kubernetes/*</span>
</span></span></code></pre></div><p>The testing section here runs a command in the container to verify a certain functionality. Then it uses our second tool, <code>container-structure-test</code>, to verify container metadata, environment variables, and other command outputs.</p>
<p>The structureTests directive points to the container-structure-test tool&rsquo;s yaml file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">commandTests</span>: 
</span></span><span style="display:flex;"><span>	- <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#34;sftp-server&#34;</span> 
</span></span><span style="display:flex;"><span>	- <span style="color:#f92672">command</span>: <span style="color:#e6db74">&#34;sftp&#34;</span> 
</span></span><span style="display:flex;"><span>	- <span style="color:#f92672">args</span>: 
</span></span><span style="display:flex;"><span>	  - <span style="color:#e6db74">&#34;-oBatchMode=no&#34;</span> 
</span></span><span style="display:flex;"><span>	  - <span style="color:#e6db74">&#34;-oStrictHostKeyChecking=no&#34;</span> 
</span></span><span style="display:flex;"><span>	  - <span style="color:#e6db74">&#34;user@localhost&#34;</span> 
</span></span><span style="display:flex;"><span>	- <span style="color:#f92672">expectedOutput</span>: - <span style="color:#e6db74">&#34;Connected to localhost.&#34;</span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadataTest</span>: 
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">env</span>: 
</span></span><span style="display:flex;"><span>	  - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">SFTP_PORT </span>
</span></span><span style="display:flex;"><span>	  - <span style="color:#f92672">value</span>: <span style="color:#ae81ff">22</span>  
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">cmd</span>: [<span style="color:#e6db74">&#34;./sftp-server&#34;</span>] 
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">workdir</span>: <span style="color:#e6db74">&#34;/app&#34;</span>
</span></span></code></pre></div><hr>
<p>How can I validate the structure of a container image?</p>
<p>How do you run tests on a new version of your application and automate the creation of a new container?</p>
<p>Set up an automation that watches source code for changes. If there are changes, then you will have a set of step ready to go that deploy to a K8s cluster, VMs, or your chosen Cloud provider.</p>
<p>Build &gt; test &gt; deploy</p>
<p>Skaffold is a CD tool for kubernetes-native applications.
Container-structure test will check and verify the structure of and image after it is built.</p>
<ul>
<li>can verify specific files exist</li>
<li>Can run commands and verify output.</li>
<li>Can verify container metadata set in a dockerfile such and environment variables, ports</li>
</ul>
<p>Skaffold will give you a template to build and test your code in the same way. This helps produce a consistent product and makes automatic deployment easier.</p>
<p>During the testing phase,</p>
<ul>
<li>Unit tests</li>
<li>Integration Tests
<ul>
<li>Does the application integrate within the rest of you environment?</li>
</ul>
</li>
<li>Security Scans
<ul>
<li>Check for known security vulnerabilities in software or imported container images.</li>
</ul>
</li>
</ul>
<p>Artifact is then built and sent to a repo that the CD phase has access to.</p>
<p>The CD Takes the artifact and deploys it using one of three strategies:</p>
<ul>
<li>Canary
<ul>
<li>Like sending a canary into a cole mine. If a select group of users survive, then the code is pushed out to everyone.</li>
</ul>
</li>
<li>Rolling
<ul>
<li>Deploys new code slowly along side of current code until all the new code is fully deployed.</li>
</ul>
</li>
<li>blue-green
<ul>
<li>Green (new) code is tested along side of blue (current)  code. If the green code is good, then it is deployed.</li>
</ul>
</li>
</ul>
<p>Monitoring is deployed to watch for errors, latency, etc. If a problem is detected then the code can be rolled back.</p>
<p>skaffold.yaml</p>
<ul>
<li>Provides instructions on building, testing, and deploying an application.</li>
<li>Located in root of project</li>
<li>Keep this file under version control</li>
<li>Three main sections:
<ul>
<li>build
<ul>
<li>how to build the image</li>
</ul>
</li>
<li>test
<ul>
<li>tests to perform on the image</li>
</ul>
</li>
<li>deploy
<ul>
<li>How to deploy to kubernetes</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Config</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">name</span>: <span style="color:#ae81ff">sftp-server</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">build</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">artifacts</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">image</span>: <span style="color:#ae81ff">project/code</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">local</span>: {}
</span></span><span style="display:flex;"><span><span style="color:#f92672">test</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">image</span>: <span style="color:#ae81ff">project/code</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">custom</span>:
</span></span><span style="display:flex;"><span>     - <span style="color:#f92672">command</span>: <span style="color:#e6db74">&#34;npm --prefix ./src test&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">structureTests</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./container-structure-tool/structure-tool.yaml</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">deploy</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">kubectl</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">manifests</span>:
</span></span><span style="display:flex;"><span>   - <span style="color:#ae81ff">kubernetes/*</span>
</span></span></code></pre></div><p><strong>Build section</strong> uses the Docker build command to create the container image. The image name is set to project/code with the image tag. This will match the image name in deployment.yaml</p>
<p>Skaffold uses the current Git commit hash to calculate the image tag. The tag is added to the container image name automatically and set as an environment variable called $IMAGE.</p>
<p><strong>test section</strong>
Run any tests on the container image or application. The example file above runs a container structure test that checks the container for defects then a custom Node.js test to</p>
<p><strong>deploy section</strong>
Uses kubernetes manifest files in /kubernetes directory to release the deployment. A patch is placed on the current deployment and the container tag and image are replaced.</p>
<p><strong>container-structure-test</strong>
Run on the container after it is built and after the application has been tested.</p>
<p>In this case, the test is located in the application&rsquo;s subdirectory /container-structure-tool/ in a file called structure-tool.yaml</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">commandTests</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#34;telnet-server&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">command</span>: <span style="color:#e6db74">&#34;./telnet-server&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">args</span>: [<span style="color:#e6db74">&#34;-i&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">expectedOutput</span>: [<span style="color:#e6db74">&#34;telnet port :2323\nMetrics Port: :9000&#34;</span>]
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadataTest</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">env</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">TELNET_PORT</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">value</span>: <span style="color:#ae81ff">2323</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">METRIC_PORT</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">value</span>: <span style="color:#ae81ff">9000</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">cmd</span>: [<span style="color:#e6db74">&#34;./telnet-server&#34;</span>]
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">workdir</span>: <span style="color:#ae81ff">&#34;/app</span>
</span></span></code></pre></div><p><strong>commandTests</strong>
command that runs the binary and args adds the -i option to output info to STDOUT. The output must match the &ldquo;expectedOutput&rdquo; value in order to pass the test.</p>
<p><strong>metadataTest</strong>
Checks the Docker file to make sure variables, commands, and working directory data matches.</p>
<p><strong>skaffold run subcommand</strong>
Build&rsquo;s, tests, and deploys the application. Does not watch for new code changes.</p>
<p><strong>skaffold dev subcommand</strong>
Same as run but watches for changes in source code and automatically runs the tests on new changes.</p>
<p>Pods will quit running after you press ^C so add the &ndash;cleanup=false argument if you want it to keep running.</p>
<p>Ran while in the code directory you are running the test on.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ skaffold dev --cleanup<span style="color:#f92672">=</span>false 
</span></span><span style="display:flex;"><span>Listing files to watch... 
</span></span><span style="display:flex;"><span>- dftd/telnet-server Generating tags... 
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Sets the container tag number, based on current git commit hash.</span>
</span></span><span style="display:flex;"><span>- dftd/telnet-server -&gt; dftd/telnet-server:4622725 
</span></span><span style="display:flex;"><span>- Checking cache... 
</span></span><span style="display:flex;"><span>- dftd/telnet-server: Not found. Building 
</span></span><span style="display:flex;"><span>- Found <span style="color:#f92672">[</span>minikube<span style="color:#f92672">]</span> context, using local docker daemon. Building <span style="color:#f92672">[</span>dftd/telnet-server<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>Successfully tagged dftd/telnet-server:4622725
</span></span><span style="display:flex;"><span><span style="color:#75715e"># skaffold starts the test section</span>
</span></span><span style="display:flex;"><span>Starting test...
</span></span><span style="display:flex;"><span>Testing images...
</span></span><span style="display:flex;"><span><span style="color:#f92672">=======================================================</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">======</span> Test file: command-and-metadata-test.yaml <span style="color:#f92672">======</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">=======================================================</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">===</span> RUN: Command Test: telnet-server --- PASS duration: 571.602755ms stdout: telnet port :2323 Metrics Port: :9000 <span style="color:#f92672">===</span> RUN: Metadata Test --- PASS duration: 0s <span style="color:#f92672">=======================================================</span> <span style="color:#f92672">=======================</span> RESULTS <span style="color:#f92672">=======================</span> <span style="color:#f92672">=======================================================</span> Passes: <span style="color:#ae81ff">2</span> Failures: <span style="color:#ae81ff">0</span> Duration: 571.602755ms
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Total tests: <span style="color:#ae81ff">2</span> PASS Running custom test command: <span style="color:#e6db74">&#34;go test ./... -v&#34;</span> ? telnet-server <span style="color:#f92672">[</span>no test files<span style="color:#f92672">]</span> ? telnet-server/metrics <span style="color:#f92672">[</span>no test files<span style="color:#f92672">]</span> <span style="color:#f92672">===</span> RUN TestServerRun Mocked charge notification <span style="color:#66d9ef">function</span> TestServerRun: server_test.go:23: PASS: Run<span style="color:#f92672">()</span> --- PASS: TestServerRun <span style="color:#f92672">(</span>0.00s<span style="color:#f92672">)</span> PASS ok telnet-server/telnet <span style="color:#f92672">(</span>cached<span style="color:#f92672">)</span> Command finished successfully.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Starts deploy</span>
</span></span><span style="display:flex;"><span>Starting deploy... - deployment.apps/telnet-server created - service/telnet-server created - service/telnet-server-metrics created Waiting <span style="color:#66d9ef">for</span> deployments to stabilize... - deployment/telnet-server: waiting <span style="color:#66d9ef">for</span> rollout to finish: <span style="color:#ae81ff">0</span> of <span style="color:#ae81ff">2</span> updated replicas are available... - pod/telnet-server-6497d64d7f-j8jq5: creating container telnet-server - pod/telnet-server-6497d64d7f-sx5ll: creating container telnet-server - deployment/telnet-server: waiting <span style="color:#66d9ef">for</span> rollout to finish: <span style="color:#ae81ff">1</span> of <span style="color:#ae81ff">2</span> updated replicas are available... - deployment/telnet-server is ready.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Deployments stabilized in 2.140948622s **Press Ctrl+C to exit** Watching <span style="color:#66d9ef">for</span> changes...
</span></span></code></pre></div><p>Can use the debug flag if you have any errors for troubleshooting.</p>
<p>skaffold will skip the build and test phase if there are no changes detected. -dirty is added to the end of the tag if the repo has uncommited changes.</p>
<p>Once you make a code change, the process will be re-run automatically if the dev option is used.</p>
<p>You can use the minicube tunnel command to jump to the server to test.</p>
<p>Grab the ip of the server:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ minikube kubectl -- get services telnet-server
</span></span><span style="display:flex;"><span>NAME TYPE CLUSTER-IP EXTERNAL-IP PORT<span style="color:#f92672">(</span>S<span style="color:#f92672">)</span> AGE 
</span></span><span style="display:flex;"><span>telnet-server LoadBalancer 10.105.161.160 **10.105.161.160** 2323:30488/TCP 6m40s
</span></span></code></pre></div><p>Verify that new pods are running:
<code>minikube kubectl</code></p>
<p>Rolling back</p>
<p>If there is no immediate disruption in service then you can deploy a hot fix and run it through the CI/CD pipeline again. If your service is down and you just need to bring it up, then just use Kubernetes to roll back.</p>
<ol>
<li>Check the rollout history:</li>
</ol>
<ul>
<li>Kubernetes tracks deployments and saves states of previous versions.</li>
</ul>
<p>To check deployment history:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>minikube kubectl -- rollout history deployment telnet-server
</span></span><span style="display:flex;"><span>deployment.apps/telnet-server
</span></span><span style="display:flex;"><span>REVISION CHANGE-CAUSE
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>           &lt;none&gt;
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span>           &lt;none&gt;
</span></span></code></pre></div><p>Revision 2 is the current active.</p>
<p>To rollback to revision 1:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>minikube kubectl -- rollout undo deployment telnet-server --to-revision<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>deployment.apps/telnet-server rolled back
</span></span></code></pre></div><p>Or leave off the <code>--to-revision</code> option to just roll back to the previous version.</p>
<p>Verify:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>minikube kubectl -- get pods
</span></span><span style="display:flex;"><span>NAME READY STATUS RESTARTS AGE telnet-server-7fb57bd65f-qc8rg 1/1 Running <span style="color:#ae81ff">0</span> 28s telnet-server-7fb57bd65f-wv4t9 1/1 Running <span style="color:#ae81ff">0</span> 29s
</span></span></code></pre></div><p>Enter the app to verify the change</p>
<p>The new revision is version 3 as listed with the <code>rollout history</code> command.</p>
<p>If your company focuses on Mean Time to Recovery (MTTR), this technique helps the service go back up as fast as possible from a customer&rsquo;s point of view.</p>

            </div>
        </article></main>
</div>
<footer class="footer">
    <span class="footer_item"> </span>
    &nbsp;

    <div class="footer_social-icons">
</div>
    <small class="footer_copyright">
        © 2024 .
        
    </small>
</footer>







    
    <script src="https://example.org/js/main.min.4ee188e1744c19816e95a540b2650ed9f033ea0371e74eac8e717355cfca8741.js" integrity="sha256-TuGI4XRMGYFulaVAsmUO2fAz6gNx506sjnFzVc/Kh0E="></script>

    

</body>
</html>
